<!DOCTYPE html>
<meta charset="utf-8">
<!-- Document styling -->
<link rel="stylesheet" href="styles.css">
<body>
  <script src="d3/d3.min.js"></script>
  <script src="library.js"></script>
  <script>
    /* Setting document and chart properties */
    var margin = {top: 20, right: 20, bottom: 70, left: 40},
        width = 1300 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;
    /* Setting the range for X */
    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);
    /* Setting the range for Y */
    var y = d3.scale.linear()
        .range([height, 0]);
    /* Creating the X Axis */
    var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");
    /* Creating the Y Axis */
    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left");

    /* Creating an SVG canvas */
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    /* Load data from file with a specific type function */
    d3.csv("Courses.csv", type, function(error, data) {

      /**
       * Process the data. If filtering is required before binding the data to
       * the DOM elements, this would be the place to do it.
       *
       **/

      data = data.filter(isNotCorrupt);


      if (error) throw error;
      /* Setting the domain for X and Y */
      x.domain(data.map(function(d) { return d["Department"] + d["Course Number"]; }));
      y.domain([0, d3.max(data, function(d) { return d.GPA; })]);
      /* Drawing the X and Y axes */
      drawXAxis();
      drawYAxis();
      /* Drawing the Bars */
      drawBars(data);

      /**
       * Create an on click event handler to filter data using the
       * D3 filter method. Remember that this method requires data to
       * be already bound to the DOM. In what cases would we do this?
       *
       **/

       var map = d3.map();
       data.forEach(function(d){
            if (!map.has(d.Department)){
                map.set(d.Department, [d.Department])
            }
        });

       var department = d3.select("body")
          .append("select")
          .attr("class", "department");

       department
          .selectAll(".option")
          .data(map.keys())
          .enter()
          .append("option")
          .attr("class","option")
          .attr("value", function(d) {
            return d;
          })
          .text(function(d) {
            return d;
          });

      d3.select("body")
          .append("p")
          .append("input")
          .attr("class", "gpa_input")
          .attr("type", "number")
          .attr("placeholder", "Enter GPA");

      d3.select("body")
          .append("p")
          .append("button")
          .on("click", filterBars)
          .text("Filter Bars");



    });

    function type(d) {
      d.GPA = +d.GPA;
      return d;
    }

    function filterBars() {
      var selectedIndex = d3.select(".department").property('selectedIndex');
      var data = d3.select(".department").selectAll('option')[0][selectedIndex].__data__;
      var gpa = d3.select(".gpa_input").property('value');
      svg.selectAll(".bar")
         .transition()
         .duration( 1000 )
         .delay(function(d) { return Math.random() * 500;} )
         .style("opacity", 1);
      svg.selectAll(".bar")
         .filter(function(d) { return d.Department != data || d.GPA < gpa; })
         .transition()
         .duration( 1000 )
         .delay(function(d) { return Math.random() * 500;} )
         .style("opacity", 0);
    }

    function isNotCorrupt(datum) {
      return datum.GPA > 0 && datum.GPA <= 4;
    }
  </script>
</body>